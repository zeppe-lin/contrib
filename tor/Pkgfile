# Description: Anonymizing overlay network
# URL:         https://www.torproject.org
# Depends on:  libcap libevent libseccomp

name=tor
version=0.4.4.8
release=1
source=(https://www.torproject.org/dist/$name-$version.tar.gz
	torrc tor.rc)

build() {
	cd $name-$version

	export PATH="/sbin:/usr/sbin:/bin:/usr/bin"

	./configure \
		--prefix=/usr          \
		--sysconfdir=/etc      \
		--localstatedir=/var   \
		--enable-system-torrc  \
		--disable-libfuzzer    \
		--disable-android      \
		--disable-html-manual  \
		--disable-rust         \
		--disable-zstd-advanced-apis

	make V=1
	make DESTDIR=$PKG install

	install -m 0700 -d $PKG/var/lib/tor $PKG/var/log/tor
	install -d $PKG/var/run/tor

	install -m 0600 -D $SRC/torrc  $PKG/etc/tor/torrc
	install -m 0750 -D $SRC/tor.rc $PKG/etc/rc.d/tor

	rm $PKG/etc/tor/torrc.sample
}
