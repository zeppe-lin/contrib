# Description: Network exploration or security auditing
# URL:         http://nmap.org
# Depends on:  libpcap libpcre lua

name=nmap
version=7.91
release=2
source=(https://nmap.org/dist/$name-$version.tar.bz2)

build () {
	cd $name-$version

	# remove default debug and optimization flags
	sed -i  \
		-e '/CFLAGS\s*=\s*/s/-g//;s/-O2//'   \
		-e '/CXXFLAGS\s*=\s*/s/-g//;s/-O2//' \
		nping/configure                      \
		libpcre/configure                    \
		libssh2/configure                    \
		ncat/configure                       \
		nsock/src/configure                  \
		configure                            \
		liblua/Makefile                      \
		nbase/configure                      \
		libdnet-stripped/configure           \
		libpcap/configure

	./configure \
		--prefix=/usr          \
		--libexecdir=/usr/lib  \
		--without-zenmap       \
		--without-ndiff        \
		--without-nping        \
		--without-ncat         \
		--without-nmap-update  \
		--disable-nls

	make V=1
	make DESTDIR=$PKG install

	rm -f $PKG/usr/share/nmap/nselib/data/psexec/README
	rm -f $PKG/usr/share/nmap/nselib/data/jdwp-class/README.txt
}
