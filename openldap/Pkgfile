# Description: Lightweight Directory Access Protocol (LDAP) Toolkit
# URL:         https://www.openldap.org/
# Depends on:  cyrus-sasl libtool perl util-linux

name=openldap
version=2.4.58
release=1
source=(https://www.openldap.org/software/download/OpenLDAP/$name-release/$name-$version.tgz
	$name-config.patch slapd.rc)

build() {
	cd $name-$version
	patch -p0 -i $SRC/$name-config.patch

	./configure \
		--prefix=/usr                  \
		--sysconfdir=/etc              \
		--libexecdir=/usr/sbin         \
		--localstatedir=/var/openldap  \
		--enable-aci                   \
		--enable-bdb                   \
		--enable-crypt                 \
		--enable-dnssrv                \
		--enable-dynamic               \
		--enable-hdb                   \
		--enable-ipv6                  \
		--enable-ldap                  \
		--enable-meta                  \
		--enable-modules               \
		--enable-monitor               \
		--enable-null                  \
		--enable-perl                  \
		--enable-rewrite               \
		--enable-shared                \
		--enable-spasswd               \
		--enable-syslog                \
		--with-cyrus-sasl              \
		--with-threads                 \
		--with-tls                     \

	make depend
	make V=1
	make DESTDIR=$PKG install

	ln -sf liblber.so   $PKG/usr/lib/liblber.so.2
	ln -sf libldap.so   $PKG/usr/lib/libldap.so.2
	ln -sf libldap_r.so $PKG/usr/lib/libldap_r.so.2

	install -m 0755 -D $SRC/slapd.rc $PKG/etc/rc.d/slapd

	rm -f $PKG/etc/openldap/schema/README
}
